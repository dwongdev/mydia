<Layouts.app {assigns}>
  <div class="flex flex-col h-full">
    <%!-- Back button and header --%>
    <div class="mb-6">
      <.link navigate={~p"/music"} class="btn btn-ghost btn-sm gap-2 mb-4">
        <.icon name="hero-arrow-left" class="w-4 h-4" /> Back to Music
      </.link>
    </div>

    <%!-- Album header --%>
    <div class="flex flex-col md:flex-row gap-6 mb-8">
      <%!-- Album cover --%>
      <div class="flex-shrink-0">
        <div class="relative">
          <img
            src={get_cover_url(@album)}
            alt={@album.title}
            class="w-48 h-48 md:w-64 md:h-64 object-cover rounded-lg shadow-lg"
          />
          <%!-- Monitored button --%>
          <button
            type="button"
            phx-click="toggle_monitored"
            class={[
              "absolute top-2 left-2 p-2 rounded-lg transition-all duration-200",
              "hover:bg-base-200 hover:scale-110 active:scale-95",
              "bg-base-100/80 backdrop-blur-sm"
            ]}
            title={if @album.monitored, do: "Unmonitor", else: "Monitor"}
          >
            <.icon
              name={if @album.monitored, do: "hero-bookmark-solid", else: "hero-bookmark"}
              class={
                if @album.monitored,
                  do: "w-6 h-6 text-primary",
                  else: "w-6 h-6 text-base-content/60"
              }
            />
          </button>
        </div>
      </div>

      <%!-- Album info --%>
      <div class="flex-1">
        <div class="flex items-start gap-2 mb-2">
          <span class="badge badge-secondary">{get_album_type_label(@album.album_type)}</span>
        </div>
        <h1 class="text-3xl font-bold mb-2">{@album.title}</h1>
        <%= if @album.artist do %>
          <.link
            navigate={~p"/music/artists/#{@album.artist.id}"}
            class="text-xl text-base-content/70 mb-4 hover:text-primary transition-colors inline-block"
          >
            {@album.artist.name}
          </.link>
        <% end %>

        <%!-- Album metadata --%>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
          <div>
            <div class="text-sm text-base-content/50">Year</div>
            <div class="font-medium">{format_year(@album.release_date)}</div>
          </div>
          <div>
            <div class="text-sm text-base-content/50">Tracks</div>
            <div class="font-medium">{length(@album.tracks)}</div>
          </div>
          <div>
            <div class="text-sm text-base-content/50">Duration</div>
            <div class="font-medium">{format_total_duration(get_total_duration(@album))}</div>
          </div>
          <div>
            <div class="text-sm text-base-content/50">Size</div>
            <div class="font-medium">{format_file_size(total_file_size(@album))}</div>
          </div>
        </div>

        <%!-- Genres --%>
        <%= if @album.genres && @album.genres != [] do %>
          <div class="flex flex-wrap gap-2">
            <%= for genre <- @album.genres do %>
              <span class="badge badge-outline">{genre}</span>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <%!-- Track listing --%>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body p-0">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th class="w-12">#</th>
                <th>Title</th>
                <th class="hidden sm:table-cell">Artist</th>
                <th class="w-20 text-right">Duration</th>
                <th class="w-16 text-center">File</th>
              </tr>
            </thead>
            <tbody>
              <%= for track <- Enum.sort_by(@album.tracks, &{&1.disc_number, &1.track_number}) do %>
                <tr class="hover">
                  <td class="text-base-content/50">
                    <%= if @album.tracks |> Enum.map(& &1.disc_number) |> Enum.uniq() |> length() > 1 do %>
                      {track.disc_number}-{track.track_number}
                    <% else %>
                      {track.track_number}
                    <% end %>
                  </td>
                  <td class="font-medium">{track.title}</td>
                  <td class="hidden sm:table-cell text-base-content/70">
                    <%= if track.artist && track.artist.id != @album.artist.id do %>
                      {track.artist.name}
                    <% else %>
                      -
                    <% end %>
                  </td>
                  <td class="text-right text-base-content/70">
                    {format_track_duration(track.duration)}
                  </td>
                  <td class="text-center">
                    <%= if track_has_file?(track) do %>
                      <.icon name="hero-check-circle" class="w-5 h-5 text-success" />
                    <% else %>
                      <.icon name="hero-x-circle" class="w-5 h-5 text-base-content/30" />
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</Layouts.app>
