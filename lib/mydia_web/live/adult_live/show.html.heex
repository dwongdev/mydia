<Layouts.app {assigns}>
  <div class="flex flex-col gap-4 max-w-6xl mx-auto" phx-window-keydown="keydown">
    <%!-- Video player --%>
    <div class="w-full">
      <.video_player
        content_type="file"
        content_id={@file.id}
        known_duration={@known_duration}
        class="aspect-video w-full rounded-lg"
      />
    </div>

    <%!-- Title and navigation row --%>
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <h1 class="text-xl font-semibold" title={get_display_name(@file)}>
          {get_display_name(@file)}
        </h1>
        <div class="flex items-center gap-3 mt-1 text-sm text-base-content/60">
          <span>{format_file_size(@file.size)}</span>
          <%= if @file.resolution do %>
            <span class="badge badge-primary badge-sm">{@file.resolution}</span>
          <% end %>
          <%= if @file.hdr_format do %>
            <span class="badge badge-accent badge-sm">{@file.hdr_format}</span>
          <% end %>
          <span>Added {format_date(@file.inserted_at)}</span>
        </div>
      </div>

      <%!-- Action buttons --%>
      <div class="flex items-center gap-2">
        <%= if video_url = get_video_url(@file) do %>
          <a
            href={video_url}
            class="btn btn-ghost btn-sm"
            target="_blank"
            rel="noopener noreferrer"
            title="Open in new tab"
          >
            <.icon name="hero-arrow-top-right-on-square" class="w-5 h-5" />
          </a>
        <% end %>

        <button
          type="button"
          class="btn btn-ghost btn-sm text-error"
          phx-click="delete_file"
          data-confirm="Are you sure you want to delete this file? This cannot be undone."
          title="Delete file"
        >
          <.icon name="hero-trash" class="w-5 h-5" />
        </button>
      </div>
    </div>

    <%!-- Navigation row --%>
    <div class="flex items-center justify-between border-t border-base-300 pt-4">
      <%= if @prev_file do %>
        <.link navigate={~p"/adult/#{@prev_file.id}"} class="btn btn-ghost btn-sm gap-2">
          <.icon name="hero-chevron-left" class="w-4 h-4" />
          <span class="hidden sm:inline truncate max-w-48">{get_display_name(@prev_file)}</span>
          <span class="sm:hidden">Previous</span>
        </.link>
      <% else %>
        <div></div>
      <% end %>

      <.link navigate={~p"/adult"} class="btn btn-ghost btn-sm">
        <.icon name="hero-squares-2x2" class="w-4 h-4" />
        <span class="hidden sm:inline">Back to Library</span>
      </.link>

      <%= if @next_file do %>
        <.link navigate={~p"/adult/#{@next_file.id}"} class="btn btn-ghost btn-sm gap-2">
          <span class="hidden sm:inline truncate max-w-48">{get_display_name(@next_file)}</span>
          <span class="sm:hidden">Next</span>
          <.icon name="hero-chevron-right" class="w-4 h-4" />
        </.link>
      <% else %>
        <div></div>
      <% end %>
    </div>

    <%!-- File details --%>
    <div class="flex flex-wrap gap-x-6 gap-y-1 text-sm text-base-content/60">
      <%= if @file.codec do %>
        <span>Video: {@file.codec}</span>
      <% end %>
      <%= if @file.audio_codec do %>
        <span>Audio: {@file.audio_codec}</span>
      <% end %>
      <%= if @file.bitrate do %>
        <span>{Float.round(@file.bitrate / 1000, 1)} kbps</span>
      <% end %>
      <%= if @file.library_path do %>
        <span class="truncate" title={@file.library_path.path}>
          {Path.basename(@file.library_path.path)}
        </span>
      <% end %>
    </div>

    <%!-- Keyboard hint --%>
    <div class="text-center text-xs text-base-content/40 pt-4">
      <kbd class="kbd kbd-xs">←</kbd> <kbd class="kbd kbd-xs">→</kbd> to navigate
    </div>
  </div>
</Layouts.app>
